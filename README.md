# Web Resilience Profile

éœæ…‹ç¶²ç«™ç”Ÿæˆå™¨ï¼Œç”¨æ–¼ç”Ÿæˆã€Œæµ·çºœæ–·æ‰æ™‚ç¶²ç«™æœƒå‹•å—ï¼Ÿã€çš„æ¸¬è©¦çµæœé é¢ã€‚

## åŠŸèƒ½èªªæ˜

é€™å€‹å°ˆæ¡ˆæœƒï¼š
1. å¾ submodule è®€å– `statistic.tsv` å–å¾—æ‰€æœ‰æ¸¬è©¦éçš„ç¶²å€
2. ç‚ºæ¯å€‹ç¶²å€ç”Ÿæˆç¨ç«‹çš„éœæ…‹ HTML é é¢
3. ä½¿ç”¨ headless browserï¼ˆPlaywrightï¼‰æ¸²æŸ“ Vue æ‡‰ç”¨ï¼Œç¢ºä¿ SEO å‹å–„
4. å°‡å»ºç½®ç”¢ç‰©éƒ¨ç½²åˆ° `gh-pages` åˆ†æ”¯ï¼Œä¾›å…¶ä»– repo ä½¿ç”¨ submodule å¼•å…¥

## å®‰è£

```bash
# å®‰è£ä¾è³´
npm install

# å®‰è£ Playwright ç€è¦½å™¨
npx playwright install chromium

# åˆå§‹åŒ–ä¸¦æ›´æ–° submoduleï¼ˆå–å¾—æ¸¬è©¦çµæœè³‡æ–™ï¼‰
git submodule update --init --recursive
```

**æ›´æ–° submoduleï¼ˆå–å¾—æœ€æ–°è³‡æ–™ï¼‰ï¼š**
```bash
git submodule update --remote test-result
```

## å¿«é€Ÿåƒè€ƒ

| æŒ‡ä»¤ | èªªæ˜ |
|------|------|
| `npm run build` | æ¸¬è©¦å»ºç½®ï¼ˆåªè™•ç†ç¬¬ä¸€å€‹ç¶²å€ï¼‰ |
| `npm run build <ç¶²ç«™åç¨±>` | å»ºç½®ç‰¹å®šç¶²ç«™ï¼ˆä¾‹å¦‚ï¼š`npm run build www.article19.org`ï¼‰ |
| `npm run build:all` | å»ºç½®æ‰€æœ‰ç¶²ç«™ |
| `npm run build-worktree` | æ‰‹å‹•åŸ·è¡Œ worktree æ“ä½œï¼ˆä¸åŸ·è¡Œå»ºç½®ï¼‰ |
| `npm run deploy` | æ¨é€ `gh-pages` åˆ†æ”¯åˆ°é ç«¯ |

## å»ºç½®æµç¨‹

### æ¸¬è©¦å»ºç½®ï¼ˆåªç·¨è­¯ä¸€å€‹ç¶²ç«™ï¼Œé è¨­ï¼‰

```bash
npm run build
```

é€™æœƒï¼š
- åªè™•ç†ç¬¬ä¸€å€‹ç¶²å€ï¼Œç”¨æ–¼å¿«é€Ÿæ¸¬è©¦å»ºç½®æµç¨‹
- å»ºç½®å®Œæˆå¾Œè‡ªå‹•æº–å‚™éƒ¨ç½²åˆ° `gh-pages` åˆ†æ”¯

### å»ºç½®ç‰¹å®šç¶²ç«™

```bash
npm run build www.article19.org
```

é€™æœƒï¼š
- åªè™•ç†æŒ‡å®šçš„ç¶²ç«™ï¼ˆæ”¯æ´éƒ¨åˆ†åŒ¹é…ï¼Œä¾‹å¦‚ `article19.org` å¯ä»¥åŒ¹é… `www.article19.org`ï¼‰
- è‡ªå‹•éæ¿¾å‡ºæ‰€æœ‰åŒ¹é…çš„ç¶²ç«™ä¸¦é€²è¡Œå»ºç½®
- å»ºç½®å®Œæˆå¾Œè‡ªå‹•æº–å‚™éƒ¨ç½²åˆ° `gh-pages` åˆ†æ”¯

**ç¯„ä¾‹ï¼š**
```bash
# å»ºç½® www.article19.org
npm run build www.article19.org

# ä½¿ç”¨éƒ¨åˆ†åç¨±ä¹Ÿå¯ä»¥ï¼ˆæœƒåŒ¹é…æ‰€æœ‰åŒ…å«è©²å­—ä¸²çš„ç¶²ç«™ï¼‰
npm run build article19.org

# å¦‚æœæ‰¾ä¸åˆ°åŒ¹é…çš„ç¶²ç«™ï¼Œæœƒé¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ä¸¦é€€å‡º
```

### å»ºç½®æ‰€æœ‰ç¶²ç«™

```bash
npm run build:all
```

é€™æœƒï¼š
- å¾ submodule è®€å– `statistic.tsv` å–å¾—æ‰€æœ‰æ¸¬è©¦ç¶²å€
- ä½¿ç”¨ 8 å€‹ä¸¦è¡Œçš„ç€è¦½å™¨å¯¦ä¾‹è™•ç†
- ç‚ºæ¯å€‹ç¶²å€ç”Ÿæˆéœæ…‹ HTML é é¢åˆ° `web/` ç›®éŒ„
- æ¯å€‹ç¶²å€æœƒå»ºç«‹ä¸€å€‹ç›®éŒ„ï¼Œä¾‹å¦‚ `web/google.com/index.html`
- ä¸»é é¢ï¼ˆ`web/index.html`ï¼‰æœƒå¾ç·šä¸Š API è®€å– JSON å’Œ statistic.tsv è³‡æ–™
- å»ºç½®å®Œæˆå¾Œè‡ªå‹•æº–å‚™éƒ¨ç½²åˆ° `gh-pages` åˆ†æ”¯

## éƒ¨ç½²åˆ° gh-pages åˆ†æ”¯

å»ºç½®æŒ‡ä»¤æœƒè‡ªå‹•å°‡ `web/` çš„å…§å®¹éƒ¨ç½²åˆ° `gh-pages` åˆ†æ”¯ã€‚å®Œæˆå»ºç½®å¾Œï¼ŒåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤æ¨é€åˆ°é ç«¯ï¼š

```bash
npm run deploy
```

é€™æœƒè‡ªå‹•åŸ·è¡Œï¼š
- æ¨é€ `gh-pages` åˆ†æ”¯åˆ°é ç«¯
- æ¸…ç†æœ¬åœ° worktree

### æ‰‹å‹•åŸ·è¡Œ worktree æ“ä½œ

å¦‚æœåªéœ€è¦æº–å‚™ worktree è€Œä¸åŸ·è¡Œå»ºç½®ï¼Œå¯ä»¥ä½¿ç”¨ï¼š

```bash
npm run build-worktree
```

é€™æœƒï¼š
- å°‡ `web/` çš„å…§å®¹éƒ¨ç½²åˆ° `gh-pages` åˆ†æ”¯ï¼ˆä¸åŸ·è¡Œå»ºç½®ï¼‰
- é©ç”¨æ–¼å·²ç¶“å®Œæˆå»ºç½®ï¼Œåªéœ€è¦æ›´æ–° worktree çš„æƒ…æ³

## å°ˆæ¡ˆçµæ§‹

```
web-resilience-profile/
â”œâ”€â”€ web/                     # å»ºç½®ç”¢ç‰©ç›®éŒ„
â”‚   â”œâ”€â”€ index.html          # ä¸»é é¢
â”‚   â”œâ”€â”€ google.com/         # æ¯å€‹ç¶²å€çš„ç›®éŒ„
â”‚   â”‚   â””â”€â”€ index.html
â”‚   â”œâ”€â”€ g0v_logo.svg        # è³‡æºæª”æ¡ˆ
â”‚   â””â”€â”€ ...                 # 
â”œâ”€â”€ test-result/  # Git submoduleï¼ˆæ¸¬è©¦çµæœè³‡æ–™ï¼‰
â”‚   â”œâ”€â”€ statistic.tsv
â”‚   â”œâ”€â”€ *.json
â”‚   â””â”€â”€ ...
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ build.js            # å»ºç½®è…³æœ¬
â”‚   â”œâ”€â”€ build-wrapper.js    # å»ºç½®åŒ…è£è…³æœ¬ï¼ˆè™•ç†åƒæ•¸å‚³éï¼‰
â”‚   â”œâ”€â”€ build-worktree.js  # éƒ¨ç½²è…³æœ¬
â”‚   â”œâ”€â”€ deploy.js           # æ¨é€èˆ‡æ¸…ç†è…³æœ¬
â”‚   â””â”€â”€ clean-worktree.js   # æ¸…ç†è…³æœ¬ï¼ˆå…§éƒ¨ä½¿ç”¨ï¼‰
â”œâ”€â”€ index.html              # åŸå§‹æ¨¡æ¿
â””â”€â”€ package.json
```

## æŠ€è¡“ç´°ç¯€

### å»ºç½®æµç¨‹

1. **è®€å–è³‡æ–™**ï¼šå¾ submodule (`test-result`) è®€å– `statistic.tsv` å–å¾—æ‰€æœ‰æ¸¬è©¦ç¶²å€
2. **éæ¿¾ç¶²å€**ï¼ˆå¯é¸ï¼‰ï¼šå¦‚æœæŒ‡å®šäº†ç¶²ç«™åç¨±ï¼Œæœƒéæ¿¾å‡ºåŒ¹é…çš„ç¶²å€ï¼ˆæ”¯æ´éƒ¨åˆ†åŒ¹é…ï¼‰
3. **å•Ÿå‹• HTTP ä¼ºæœå™¨**ï¼šåœ¨æœ¬åœ°å•Ÿå‹• HTTP ä¼ºæœå™¨æä¾› `index.html`ï¼ˆå»ºç½®æ™‚å¾ submodule è®€å– JSON å’Œ statistic.tsvï¼‰
4. **ä¸¦è¡Œè™•ç†**ï¼šä½¿ç”¨ 8 å€‹ Playwright ç€è¦½å™¨å¯¦ä¾‹ä¸¦è¡Œè™•ç†
5. **ç”Ÿæˆéœæ…‹ HTML**ï¼šé€é headless browser è¼‰å…¥é é¢ä¸¦æ¸²æŸ“ï¼Œç”Ÿæˆå®Œæ•´ HTMLï¼ŒåŒ…å«ï¼š
   - æ­£ç¢ºçš„ title å’Œ meta æ¨™ç±¤ï¼ˆSEO å‹å–„ï¼‰
   - å·²æ¸²æŸ“çš„å…§å®¹ï¼ˆæœå°‹å¼•æ“å¯ç›´æ¥ç´¢å¼•ï¼‰
   - Vue äº’å‹•åŠŸèƒ½ï¼ˆç”¨æˆ¶å¯ä»¥å±•é–‹/æ”¶åˆè©³ç´°è³‡è¨Šï¼‰

### è·¯å¾‘è™•ç†

- æ¯å€‹ç¶²å€æœƒå»ºç«‹ä¸€å€‹ç›®éŒ„ï¼Œä¾‹å¦‚ `google.com/index.html`
- å°æ‡‰è¨ªå• URL ç‚º `https://resilience.ocf.tw/web/google.com/`

## ç›¸é—œé€£çµ

- ç ”ç©¶æ–¹æ³•èˆ‡åŸå§‹ç¢¼ï¼šhttps://github.com/irvin/web-resilience-test
- æ¸¬è©¦çµæœè³‡æ–™ï¼šhttps://github.com/irvin/web-resilience-test-result

## License

CC BY-NC-ND 4.0 International License

## ğŸ™ è‡´è¬

This work was supported by a grant from the APNIC Foundation, via the Information Society Innovation Fund (ISIF Asia).